{"ast":null,"code":"var _jsxFileName = \"G:\\\\holy-family-polymers\\\\client\\\\src\\\\pages\\\\buyers\\\\CheckoutPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useCart } from '../../context/CartContext';\nimport { placeOrder, createRazorpayOrder, verifyRazorpayPayment } from '../../services/storeService';\nimport './buyers.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CheckoutPage = () => {\n  _s();\n  const {\n    items,\n    clearCart,\n    totals\n  } = useCart();\n  const [notes, setNotes] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n  const loadRazorpay = () => new Promise(resolve => {\n    if (window.Razorpay) return resolve(true);\n    const script = document.createElement('script');\n    script.src = 'https://checkout.razorpay.com/v1/checkout.js';\n    script.onload = () => resolve(true);\n    script.onerror = () => resolve(false);\n    document.body.appendChild(script);\n  });\n  const submit = async () => {\n    var _res$order;\n    setLoading(true);\n    if (!items || items.length === 0 || totals.subtotal <= 0) {\n      setLoading(false);\n      return alert('Your cart is empty or total is invalid.');\n    }\n    const payload = {\n      items: items.map(i => ({\n        product: i.productId,\n        name: i.name,\n        type: i.type,\n        category: i.category,\n        unitPrice: i.price,\n        quantity: i.quantity,\n        subtotal: i.price * i.quantity\n      })),\n      notes\n    };\n    const res = await placeOrder(payload);\n    if (!(res !== null && res !== void 0 && res.success) || !((_res$order = res.order) !== null && _res$order !== void 0 && _res$order._id)) {\n      setLoading(false);\n      return alert((res === null || res === void 0 ? void 0 : res.message) || 'Failed to place order');\n    }\n    const ok = await loadRazorpay();\n    if (!ok) {\n      setLoading(false);\n      return alert('Failed to load payment gateway.');\n    }\n    const pr = await createRazorpayOrder(res.order._id);\n    if (!(pr !== null && pr !== void 0 && pr.success)) {\n      setLoading(false);\n      return alert((pr === null || pr === void 0 ? void 0 : pr.message) || 'Unable to initiate payment');\n    }\n    const options = {\n      key: pr.key,\n      amount: pr.amount,\n      currency: pr.currency || 'INR',\n      name: 'Holy Family Polymers',\n      description: 'Order Payment',\n      order_id: pr.rpOrderId,\n      handler: async function (response) {\n        const verify = await verifyRazorpayPayment(res.order._id, {\n          razorpay_order_id: response.razorpay_order_id,\n          razorpay_payment_id: response.razorpay_payment_id,\n          razorpay_signature: response.razorpay_signature\n        });\n        setLoading(false);\n        if (verify !== null && verify !== void 0 && verify.success) {\n          clearCart();\n          navigate('/buyers/orders');\n        } else {\n          alert((verify === null || verify === void 0 ? void 0 : verify.message) || 'Payment verification failed');\n        }\n      },\n      theme: {\n        color: '#0f766e'\n      },\n      modal: {\n        ondismiss: () => {\n          setLoading(false);\n        }\n      }\n    };\n    const rzp = new window.Razorpay(options);\n    rzp.on('payment.failed', function () {\n      setLoading(false);\n      alert('Payment failed. Please try again.');\n    });\n    rzp.open();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"buyers-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"buyers-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Checkout\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Total: \\u20B9\", totals.subtotal]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), items.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"buyers-empty\",\n      children: \"Your cart is empty.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"checkout-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Notes (optional)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        value: notes,\n        onChange: e => setNotes(e.target.value),\n        placeholder: \"Any special request...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"buyers-btn primary\",\n        onClick: submit,\n        disabled: loading,\n        children: loading ? 'Placing order...' : 'Place Order'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n_s(CheckoutPage, \"mqIYn/YhJrjvsmDukGKAwryJYOM=\", false, function () {\n  return [useCart, useNavigate];\n});\n_c = CheckoutPage;\nexport default CheckoutPage;\nvar _c;\n$RefreshReg$(_c, \"CheckoutPage\");","map":{"version":3,"names":["React","useState","useNavigate","useCart","placeOrder","createRazorpayOrder","verifyRazorpayPayment","jsxDEV","_jsxDEV","CheckoutPage","_s","items","clearCart","totals","notes","setNotes","loading","setLoading","navigate","loadRazorpay","Promise","resolve","window","Razorpay","script","document","createElement","src","onload","onerror","body","appendChild","submit","_res$order","length","subtotal","alert","payload","map","i","product","productId","name","type","category","unitPrice","price","quantity","res","success","order","_id","message","ok","pr","options","key","amount","currency","description","order_id","rpOrderId","handler","response","verify","razorpay_order_id","razorpay_payment_id","razorpay_signature","theme","color","modal","ondismiss","rzp","on","open","className","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","placeholder","onClick","disabled","_c","$RefreshReg$"],"sources":["G:/holy-family-polymers/client/src/pages/buyers/CheckoutPage.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useCart } from '../../context/CartContext';\r\nimport { placeOrder, createRazorpayOrder, verifyRazorpayPayment } from '../../services/storeService';\r\nimport './buyers.css';\r\n\r\nconst CheckoutPage = () => {\r\n  const { items, clearCart, totals } = useCart();\r\n  const [notes, setNotes] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const loadRazorpay = () => new Promise((resolve) => {\r\n    if (window.Razorpay) return resolve(true);\r\n    const script = document.createElement('script');\r\n    script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n    script.onload = () => resolve(true);\r\n    script.onerror = () => resolve(false);\r\n    document.body.appendChild(script);\r\n  });\r\n\r\n  const submit = async () => {\r\n    setLoading(true);\r\n    if (!items || items.length === 0 || totals.subtotal <= 0) {\r\n      setLoading(false);\r\n      return alert('Your cart is empty or total is invalid.');\r\n    }\r\n    const payload = {\r\n      items: items.map(i => ({\r\n        product: i.productId,\r\n        name: i.name,\r\n        type: i.type,\r\n        category: i.category,\r\n        unitPrice: i.price,\r\n        quantity: i.quantity,\r\n        subtotal: i.price * i.quantity,\r\n      })),\r\n      notes,\r\n    };\r\n    const res = await placeOrder(payload);\r\n    if (!res?.success || !res.order?._id) {\r\n      setLoading(false);\r\n      return alert(res?.message || 'Failed to place order');\r\n    }\r\n\r\n    const ok = await loadRazorpay();\r\n    if (!ok) {\r\n      setLoading(false);\r\n      return alert('Failed to load payment gateway.');\r\n    }\r\n\r\n    const pr = await createRazorpayOrder(res.order._id);\r\n    if (!pr?.success) {\r\n      setLoading(false);\r\n      return alert(pr?.message || 'Unable to initiate payment');\r\n    }\r\n\r\n    const options = {\r\n      key: pr.key,\r\n      amount: pr.amount,\r\n      currency: pr.currency || 'INR',\r\n      name: 'Holy Family Polymers',\r\n      description: 'Order Payment',\r\n      order_id: pr.rpOrderId,\r\n      handler: async function (response) {\r\n        const verify = await verifyRazorpayPayment(res.order._id, {\r\n          razorpay_order_id: response.razorpay_order_id,\r\n          razorpay_payment_id: response.razorpay_payment_id,\r\n          razorpay_signature: response.razorpay_signature,\r\n        });\r\n        setLoading(false);\r\n        if (verify?.success) {\r\n          clearCart();\r\n          navigate('/buyers/orders');\r\n        } else {\r\n          alert(verify?.message || 'Payment verification failed');\r\n        }\r\n      },\r\n      theme: { color: '#0f766e' },\r\n      modal: {\r\n        ondismiss: () => {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    const rzp = new window.Razorpay(options);\r\n    rzp.on('payment.failed', function () {\r\n      setLoading(false);\r\n      alert('Payment failed. Please try again.');\r\n    });\r\n    rzp.open();\r\n  };\r\n\r\n  return (\r\n    <div className=\"buyers-container\">\r\n      <div className=\"buyers-header\">\r\n        <h1>Checkout</h1>\r\n        <p>Total: â‚¹{totals.subtotal}</p>\r\n      </div>\r\n\r\n      {items.length === 0 ? (\r\n        <div className=\"buyers-empty\">Your cart is empty.</div>\r\n      ) : (\r\n        <div className=\"checkout-panel\">\r\n          <label>Notes (optional)</label>\r\n          <textarea value={notes} onChange={(e) => setNotes(e.target.value)} placeholder=\"Any special request...\" />\r\n          <button className=\"buyers-btn primary\" onClick={submit} disabled={loading}>\r\n            {loading ? 'Placing order...' : 'Place Order'}\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CheckoutPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}