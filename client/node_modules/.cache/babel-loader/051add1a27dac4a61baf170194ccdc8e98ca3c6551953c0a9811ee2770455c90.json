{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[isAuthenticated,setIsAuthenticated]=useState(false);// Validate token on app start\nuseEffect(()=>{validateToken();},[]);const validateToken=async()=>{const token=localStorage.getItem('token');if(!token){setLoading(false);setIsAuthenticated(false);return;}// Basic token format validation\nif(typeof token!=='string'||token.trim()===''){console.error('Invalid token format in localStorage');logout();return;}try{// Set default authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);const response=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/validate-token\"));if(response.data.valid){setUser(response.data.user);setIsAuthenticated(true);// Check if registration is complete\nconst regResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/registration-status\"));if(!regResponse.data.isComplete){// Registration incomplete, log out user\nlogout();return;}}else{logout();}}catch(error){var _error$response;console.error('Token validation failed:',error);// Handle specific error types\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){// Token is invalid, clear it\nlogout();}else{// Network or other error, keep token but mark as not authenticated\nsetIsAuthenticated(false);}}finally{setLoading(false);}};const login=async(email,password)=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/login\"),{email,password});const{token,user:userData}=response.data;// Validate token format before storing\nif(!token||typeof token!=='string'||token.trim()===''){throw new Error('Invalid token received from server');}// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Check registration status\nconst regResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/registration-status\"));if(!regResponse.data.isComplete){logout();throw new Error('Registration incomplete. Please complete your profile first.');}setUser(userData);setIsAuthenticated(true);return{success:true,user:userData};}catch(error){throw error;}};const register=async userData=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/register\"),userData);const{token,user:newUser}=response.data;// Validate token format before storing\nif(!token||typeof token!=='string'||token.trim()===''){throw new Error('Invalid token received from server');}// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(newUser));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(newUser);setIsAuthenticated(true);return{success:true,user:newUser};}catch(error){throw error;}};const logout=()=>{localStorage.removeItem('token');localStorage.removeItem('user');delete axios.defaults.headers.common['Authorization'];setUser(null);setIsAuthenticated(false);};const googleSignIn=async credential=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/google-signin\"),{token:credential});const{token,user:userData}=response.data;// Validate token format before storing\nif(!token||typeof token!=='string'||token.trim()===''){throw new Error('Invalid token received from server');}// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(userData);setIsAuthenticated(true);return{success:true,user:userData};}catch(error){throw error;}};const value={user,loading,isAuthenticated,login,register,logout,googleSignIn,validateToken};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","isAuthenticated","setIsAuthenticated","validateToken","token","localStorage","getItem","trim","console","error","logout","defaults","headers","common","concat","response","get","process","env","REACT_APP_API_URL","data","valid","regResponse","isComplete","_error$response","status","login","email","password","post","userData","setItem","JSON","stringify","success","register","newUser","removeItem","googleSignIn","credential","value","Provider"],"sources":["G:/holy-family-polymers/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n    // Validate token on app start\r\n    useEffect(() => {\r\n        validateToken();\r\n    }, []);\r\n\r\n    const validateToken = async () => {\r\n        const token = localStorage.getItem('token');\r\n        \r\n        if (!token) {\r\n            setLoading(false);\r\n            setIsAuthenticated(false);\r\n            return;\r\n        }\r\n\r\n        // Basic token format validation\r\n        if (typeof token !== 'string' || token.trim() === '') {\r\n            console.error('Invalid token format in localStorage');\r\n            logout();\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Set default authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            const response = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/validate-token`);\r\n            \r\n            if (response.data.valid) {\r\n                setUser(response.data.user);\r\n                setIsAuthenticated(true);\r\n                \r\n                // Check if registration is complete\r\n                const regResponse = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/registration-status`);\r\n                \r\n                if (!regResponse.data.isComplete) {\r\n                    // Registration incomplete, log out user\r\n                    logout();\r\n                    return;\r\n                }\r\n            } else {\r\n                logout();\r\n            }\r\n        } catch (error) {\r\n            console.error('Token validation failed:', error);\r\n            \r\n            // Handle specific error types\r\n            if (error.response?.status === 401) {\r\n                // Token is invalid, clear it\r\n                logout();\r\n            } else {\r\n                // Network or other error, keep token but mark as not authenticated\r\n                setIsAuthenticated(false);\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const login = async (email, password) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/login`, {\r\n                email,\r\n                password\r\n            });\r\n\r\n            const { token, user: userData } = response.data;\r\n            \r\n            // Validate token format before storing\r\n            if (!token || typeof token !== 'string' || token.trim() === '') {\r\n                throw new Error('Invalid token received from server');\r\n            }\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            // Check registration status\r\n            const regResponse = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/registration-status`);\r\n            \r\n            if (!regResponse.data.isComplete) {\r\n                logout();\r\n                throw new Error('Registration incomplete. Please complete your profile first.');\r\n            }\r\n\r\n            setUser(userData);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: userData };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const register = async (userData) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/register`, userData);\r\n            \r\n            const { token, user: newUser } = response.data;\r\n            \r\n            // Validate token format before storing\r\n            if (!token || typeof token !== 'string' || token.trim() === '') {\r\n                throw new Error('Invalid token received from server');\r\n            }\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(newUser));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            setUser(newUser);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: newUser };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        delete axios.defaults.headers.common['Authorization'];\r\n        setUser(null);\r\n        setIsAuthenticated(false);\r\n    };\r\n\r\n    const googleSignIn = async (credential) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/google-signin`, {\r\n                token: credential\r\n            });\r\n\r\n            const { token, user: userData } = response.data;\r\n            \r\n            // Validate token format before storing\r\n            if (!token || typeof token !== 'string' || token.trim() === '') {\r\n                throw new Error('Invalid token received from server');\r\n            }\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            setUser(userData);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: userData };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        isAuthenticated,\r\n        login,\r\n        register,\r\n        logout,\r\n        googleSignIn,\r\n        validateToken\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC7E,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE1B,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAC,CAAC,CAEnC,MAAO,MAAM,CAAAQ,OAAO,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAAC,OAAO,CAAGR,UAAU,CAACM,WAAW,CAAC,CACvC,GAAI,CAACE,OAAO,CAAE,CACV,KAAM,IAAI,CAAAC,KAAK,CAAC,6CAA6C,CAAC,CAClE,CACA,MAAO,CAAAD,OAAO,CAClB,CAAC,CAED,MAAO,MAAM,CAAAE,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACrC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACc,OAAO,CAAEC,UAAU,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACgB,eAAe,CAAEC,kBAAkB,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAE7D;AACAC,SAAS,CAAC,IAAM,CACZiB,aAAa,CAAC,CAAC,CACnB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAA,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C,GAAI,CAACF,KAAK,CAAE,CACRJ,UAAU,CAAC,KAAK,CAAC,CACjBE,kBAAkB,CAAC,KAAK,CAAC,CACzB,OACJ,CAEA;AACA,GAAI,MAAO,CAAAE,KAAK,GAAK,QAAQ,EAAIA,KAAK,CAACG,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAClDC,OAAO,CAACC,KAAK,CAAC,sCAAsC,CAAC,CACrDC,MAAM,CAAC,CAAC,CACR,OACJ,CAEA,GAAI,CACA;AACAvB,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAaV,KAAK,CAAE,CAElE,KAAM,CAAAW,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC6B,GAAG,IAAAF,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,4BAA0B,CAAC,CAEvH,GAAIJ,QAAQ,CAACK,IAAI,CAACC,KAAK,CAAE,CACrBvB,OAAO,CAACiB,QAAQ,CAACK,IAAI,CAACvB,IAAI,CAAC,CAC3BK,kBAAkB,CAAC,IAAI,CAAC,CAExB;AACA,KAAM,CAAAoB,WAAW,CAAG,KAAM,CAAAnC,KAAK,CAAC6B,GAAG,IAAAF,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,iCAA+B,CAAC,CAE/H,GAAI,CAACG,WAAW,CAACF,IAAI,CAACG,UAAU,CAAE,CAC9B;AACAb,MAAM,CAAC,CAAC,CACR,OACJ,CACJ,CAAC,IAAM,CACHA,MAAM,CAAC,CAAC,CACZ,CACJ,CAAE,MAAOD,KAAK,CAAE,KAAAe,eAAA,CACZhB,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAEhD;AACA,GAAI,EAAAe,eAAA,CAAAf,KAAK,CAACM,QAAQ,UAAAS,eAAA,iBAAdA,eAAA,CAAgBC,MAAM,IAAK,GAAG,CAAE,CAChC;AACAf,MAAM,CAAC,CAAC,CACZ,CAAC,IAAM,CACH;AACAR,kBAAkB,CAAC,KAAK,CAAC,CAC7B,CACJ,CAAC,OAAS,CACNF,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAED,KAAM,CAAA0B,KAAK,CAAG,KAAAA,CAAOC,KAAK,CAAEC,QAAQ,GAAK,CACrC,GAAI,CACA,KAAM,CAAAb,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC0C,IAAI,IAAAf,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,oBAAmB,CAC5GQ,KAAK,CACLC,QACJ,CAAC,CAAC,CAEF,KAAM,CAAExB,KAAK,CAAEP,IAAI,CAAEiC,QAAS,CAAC,CAAGf,QAAQ,CAACK,IAAI,CAE/C;AACA,GAAI,CAAChB,KAAK,EAAI,MAAO,CAAAA,KAAK,GAAK,QAAQ,EAAIA,KAAK,CAACG,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAC5D,KAAM,IAAI,CAAAd,KAAK,CAAC,oCAAoC,CAAC,CACzD,CAEA;AACAY,YAAY,CAAC0B,OAAO,CAAC,OAAO,CAAE3B,KAAK,CAAC,CACpCC,YAAY,CAAC0B,OAAO,CAAC,MAAM,CAAEC,IAAI,CAACC,SAAS,CAACH,QAAQ,CAAC,CAAC,CAEtD;AACA3C,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAaV,KAAK,CAAE,CAElE;AACA,KAAM,CAAAkB,WAAW,CAAG,KAAM,CAAAnC,KAAK,CAAC6B,GAAG,IAAAF,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,iCAA+B,CAAC,CAE/H,GAAI,CAACG,WAAW,CAACF,IAAI,CAACG,UAAU,CAAE,CAC9Bb,MAAM,CAAC,CAAC,CACR,KAAM,IAAI,CAAAjB,KAAK,CAAC,8DAA8D,CAAC,CACnF,CAEAK,OAAO,CAACgC,QAAQ,CAAC,CACjB5B,kBAAkB,CAAC,IAAI,CAAC,CAExB,MAAO,CAAEgC,OAAO,CAAE,IAAI,CAAErC,IAAI,CAAEiC,QAAS,CAAC,CAC5C,CAAE,MAAOrB,KAAK,CAAE,CACZ,KAAM,CAAAA,KAAK,CACf,CACJ,CAAC,CAED,KAAM,CAAA0B,QAAQ,CAAG,KAAO,CAAAL,QAAQ,EAAK,CACjC,GAAI,CACA,KAAM,CAAAf,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC0C,IAAI,IAAAf,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,uBAAsBW,QAAQ,CAAC,CAE5H,KAAM,CAAE1B,KAAK,CAAEP,IAAI,CAAEuC,OAAQ,CAAC,CAAGrB,QAAQ,CAACK,IAAI,CAE9C;AACA,GAAI,CAAChB,KAAK,EAAI,MAAO,CAAAA,KAAK,GAAK,QAAQ,EAAIA,KAAK,CAACG,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAC5D,KAAM,IAAI,CAAAd,KAAK,CAAC,oCAAoC,CAAC,CACzD,CAEA;AACAY,YAAY,CAAC0B,OAAO,CAAC,OAAO,CAAE3B,KAAK,CAAC,CACpCC,YAAY,CAAC0B,OAAO,CAAC,MAAM,CAAEC,IAAI,CAACC,SAAS,CAACG,OAAO,CAAC,CAAC,CAErD;AACAjD,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAaV,KAAK,CAAE,CAElEN,OAAO,CAACsC,OAAO,CAAC,CAChBlC,kBAAkB,CAAC,IAAI,CAAC,CAExB,MAAO,CAAEgC,OAAO,CAAE,IAAI,CAAErC,IAAI,CAAEuC,OAAQ,CAAC,CAC3C,CAAE,MAAO3B,KAAK,CAAE,CACZ,KAAM,CAAAA,KAAK,CACf,CACJ,CAAC,CAED,KAAM,CAAAC,MAAM,CAAGA,CAAA,GAAM,CACjBL,YAAY,CAACgC,UAAU,CAAC,OAAO,CAAC,CAChChC,YAAY,CAACgC,UAAU,CAAC,MAAM,CAAC,CAC/B,MAAO,CAAAlD,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,CACrDf,OAAO,CAAC,IAAI,CAAC,CACbI,kBAAkB,CAAC,KAAK,CAAC,CAC7B,CAAC,CAED,KAAM,CAAAoC,YAAY,CAAG,KAAO,CAAAC,UAAU,EAAK,CACvC,GAAI,CACA,KAAM,CAAAxB,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC0C,IAAI,IAAAf,MAAA,CAAIG,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,4BAA2B,CACpHf,KAAK,CAAEmC,UACX,CAAC,CAAC,CAEF,KAAM,CAAEnC,KAAK,CAAEP,IAAI,CAAEiC,QAAS,CAAC,CAAGf,QAAQ,CAACK,IAAI,CAE/C;AACA,GAAI,CAAChB,KAAK,EAAI,MAAO,CAAAA,KAAK,GAAK,QAAQ,EAAIA,KAAK,CAACG,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAC5D,KAAM,IAAI,CAAAd,KAAK,CAAC,oCAAoC,CAAC,CACzD,CAEA;AACAY,YAAY,CAAC0B,OAAO,CAAC,OAAO,CAAE3B,KAAK,CAAC,CACpCC,YAAY,CAAC0B,OAAO,CAAC,MAAM,CAAEC,IAAI,CAACC,SAAS,CAACH,QAAQ,CAAC,CAAC,CAEtD;AACA3C,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,WAAAC,MAAA,CAAaV,KAAK,CAAE,CAElEN,OAAO,CAACgC,QAAQ,CAAC,CACjB5B,kBAAkB,CAAC,IAAI,CAAC,CAExB,MAAO,CAAEgC,OAAO,CAAE,IAAI,CAAErC,IAAI,CAAEiC,QAAS,CAAC,CAC5C,CAAE,MAAOrB,KAAK,CAAE,CACZ,KAAM,CAAAA,KAAK,CACf,CACJ,CAAC,CAED,KAAM,CAAA+B,KAAK,CAAG,CACV3C,IAAI,CACJE,OAAO,CACPE,eAAe,CACfyB,KAAK,CACLS,QAAQ,CACRzB,MAAM,CACN4B,YAAY,CACZnC,aACJ,CAAC,CAED,mBACId,IAAA,CAACC,WAAW,CAACmD,QAAQ,EAACD,KAAK,CAAEA,KAAM,CAAA5C,QAAA,CAC9BA,QAAQ,CACS,CAAC,CAE/B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}