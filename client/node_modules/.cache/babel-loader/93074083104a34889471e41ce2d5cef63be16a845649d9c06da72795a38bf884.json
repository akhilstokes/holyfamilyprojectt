{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[isAuthenticated,setIsAuthenticated]=useState(false);// Validate token on app start\nuseEffect(()=>{validateToken();},[]);const validateToken=async()=>{const token=localStorage.getItem('token');if(!token){setLoading(false);setIsAuthenticated(false);return;}try{// Set default authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);const response=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/validate-token\"));if(response.data.valid){setUser(response.data.user);setIsAuthenticated(true);// Check if registration is complete\nconst regResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/registration-status\"));if(!regResponse.data.isComplete){// Registration incomplete, log out user\nlogout();return;}}else{logout();}}catch(error){console.error('Token validation failed:',error);logout();}finally{setLoading(false);}};const login=async(email,password)=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/login\"),{email,password});const{token,user:userData}=response.data;// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Check registration status\nconst regResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/registration-status\"));if(!regResponse.data.isComplete){logout();throw new Error('Registration incomplete. Please complete your profile first.');}setUser(userData);setIsAuthenticated(true);return{success:true,user:userData};}catch(error){throw error;}};const register=async userData=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/register\"),userData);const{token,user:newUser}=response.data;// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(newUser));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(newUser);setIsAuthenticated(true);return{success:true,user:newUser};}catch(error){throw error;}};const logout=()=>{localStorage.removeItem('token');localStorage.removeItem('user');delete axios.defaults.headers.common['Authorization'];setUser(null);setIsAuthenticated(false);};const googleSignIn=async credential=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/google-signin\"),{token:credential});const{token,user:userData}=response.data;// Store token and user data\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(userData));// Set authorization header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(userData);setIsAuthenticated(true);return{success:true,user:userData};}catch(error){throw error;}};const value={user,loading,isAuthenticated,login,register,logout,googleSignIn,validateToken};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","isAuthenticated","setIsAuthenticated","validateToken","token","localStorage","getItem","defaults","headers","common","concat","response","get","process","env","REACT_APP_API_URL","data","valid","regResponse","isComplete","logout","error","console","login","email","password","post","userData","setItem","JSON","stringify","success","register","newUser","removeItem","googleSignIn","credential","value","Provider"],"sources":["G:/holy-family-polymers/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n    // Validate token on app start\r\n    useEffect(() => {\r\n        validateToken();\r\n    }, []);\r\n\r\n    const validateToken = async () => {\r\n        const token = localStorage.getItem('token');\r\n        \r\n        if (!token) {\r\n            setLoading(false);\r\n            setIsAuthenticated(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Set default authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            const response = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/validate-token`);\r\n            \r\n            if (response.data.valid) {\r\n                setUser(response.data.user);\r\n                setIsAuthenticated(true);\r\n                \r\n                // Check if registration is complete\r\n                const regResponse = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/registration-status`);\r\n                \r\n                if (!regResponse.data.isComplete) {\r\n                    // Registration incomplete, log out user\r\n                    logout();\r\n                    return;\r\n                }\r\n            } else {\r\n                logout();\r\n            }\r\n        } catch (error) {\r\n            console.error('Token validation failed:', error);\r\n            logout();\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const login = async (email, password) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/login`, {\r\n                email,\r\n                password\r\n            });\r\n\r\n            const { token, user: userData } = response.data;\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            // Check registration status\r\n            const regResponse = await axios.get(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/registration-status`);\r\n            \r\n            if (!regResponse.data.isComplete) {\r\n                logout();\r\n                throw new Error('Registration incomplete. Please complete your profile first.');\r\n            }\r\n\r\n            setUser(userData);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: userData };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const register = async (userData) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/register`, userData);\r\n            \r\n            const { token, user: newUser } = response.data;\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(newUser));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            setUser(newUser);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: newUser };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        delete axios.defaults.headers.common['Authorization'];\r\n        setUser(null);\r\n        setIsAuthenticated(false);\r\n    };\r\n\r\n    const googleSignIn = async (credential) => {\r\n        try {\r\n            const response = await axios.post(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/google-signin`, {\r\n                token: credential\r\n            });\r\n\r\n            const { token, user: userData } = response.data;\r\n            \r\n            // Store token and user data\r\n            localStorage.setItem('token', token);\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            \r\n            // Set authorization header\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            \r\n            setUser(userData);\r\n            setIsAuthenticated(true);\r\n            \r\n            return { success: true, user: userData };\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        isAuthenticated,\r\n        login,\r\n        register,\r\n        logout,\r\n        googleSignIn,\r\n        validateToken\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}